<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Peças</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body{background:#0d1b2a;color:#fff;padding-top:80px}
    .navbar{background:#1b263b;border-bottom:4px solid #e63946}
    .nav-link{color:#fff!important;font-weight:600}
    .nav-link:hover{background:#e63946;color:#fff!important;border-radius:10px}
  </style>
</head>
<body>
  <nav class="navbar fixed-top navbar-expand">
    <div class="container-fluid">
      <a class="navbar-brand text-white fs-4" href="dashboard.html">Injetoras PRO</a>
      <div class="navbar-nav ms-auto">
        <a class="nav-link active" href="#">Peças</a>
        <a class="nav-link" href="producao.html">Produção</a>
        <a class="nav-link" href="banco-materias.html">Banco</a>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <h2 class="text-center mb-4">Cadastro de Peças</h2>
    <div class="card bg-secondary p-4">
      <div class="row g-3">
        <div class="col-md-3"><input type="text" id="codigo" class="form-control" placeholder="Código"></div>
        <div class="col-md-4"><input type="text" id="nome" class="form-control" placeholder="Nome da Peça"></div>
        <div class="col-md-3"><input type="text" id="cor" class="form-control" placeholder="Cor"></div>
        <div class="col-md-3"><input type="file" id="foto" accept="image/*" class="form-control"></div>
        <div class="col-md-3"><input type="text" id="material" class="form-control" placeholder="Material"></div>
        <div class="col-md-2"><button class="btn btn-success w-100" onclick="addPeca()">Adicionar</button></div>
      </div>
      <div class="mt-3">
        <button class="btn btn-warning" onclick="exportPecas()">Exportar Excel</button>
      </div>
    </div>

    <div id="listaPecas" class="row mt-4 g-4"></div>
  </div>

  <script>
    if(!sessionStorage.getItem('logado')) location.href='index.html';
    function addPeca(){
      const codigo = document.getElementById('codigo').value.trim();
      const nome = document.getElementById('nome').value.trim();
      const cor = document.getElementById('cor').value;
      const material = document.getElementById('material').value;
      const file = document.getElementById('foto').files[0];
      if(!codigo || !nome) return alert('Preencha código e nome!');

      const reader = new FileReader();
      reader.onload = function(e){
        let pecas = JSON.parse(localStorage.getItem('pecas')||'[]');
        if(pecas.find(p=>p.codigo===codigo)) return alert('Código já existe!');
        pecas.push({codigo,nome,cor,material,foto:e.target.result||'',produzidas:0});
        localStorage.setItem('pecas',JSON.stringify(pecas));
        listar();
      };
      if(file) reader.readAsDataURL(file);
      else reader.onload({target:{result:''}});
    }
    function listar(){
      const lista = document.getElementById('listaPecas');
      const pecas = JSON.parse(localStorage.getItem('pecas')||'[]');
      lista.innerHTML = '';
      pecas.forEach(p=>{
        lista.innerHTML += `
          <div class="col-md-4">
            <div class="card bg-dark text-white">
              ${p.foto?`<img src="${p.foto}" class="card-img-top" style="height:220px;object-fit:cover">`:''}
              <div class="card-body">
                <h5>${p.codigo} - ${p.nome}</h5>
                <p>Cor: ${p.cor}<br>Material: ${p.material}<br>Produzidas: <strong>${p.produzidas||0}</strong></p>
              </div>
            </div>
          </div>`;
      });
    }
    function exportPecas(){
      const pecas = JSON.parse(localStorage.getItem('pecas')||'[]');
      const data = pecas.map(p=>({Código:p.codigo,Nome:p.nome,Cor:p.cor,Material:p.material,Produzidas:p.produzidas||0}));
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,"Peças");
      XLSX.writeFile(wb,"pecas_cadastradas.xlsx");
    }
    listar();
  </script>
</body>
</html>
