<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Relatório</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>body{background:#0d1b2a;color:#fff;padding-top:80px}</style>
</head>
<body>
  <nav class="navbar fixed-top bg-black">
    <div class="container-fluid">
      <a class="navbar-brand text-danger fs-4" href="dashboard.html">Injetoras PRO</a>
    </div>
  </nav>

  <div class="container mt-5">
    <h1 class="text-center mb-5">Relatório Completo</h1>
    <div id="relatorio" class="card bg-white text-dark p-5">
      <h2 class="text-center">Relatório Injetoras PRO</h2>
      <h4>Data: ${new Date().toLocaleDateString('pt-BR')}</h4>
      <div id="conteudo"></div>
      <div class="text-center mt-4">
        <button class="btn btn-danger btn-lg me-3" onclick="gerarPDF()">PDF</button>
        <button class="btn btn-success btn-lg" onclick="enviarWhats()">WhatsApp</button>
      </div>
    </div>
  </div>

  <script>
    if(!sessionStorage.getItem('logado')) location.href='index.html';
    const mp = JSON.parse(localStorage.getItem('materias')||'[]');
    const pecas = JSON.parse(localStorage.getItem('pecas')||'[]');
    const prod = JSON.parse(localStorage.getItem('producao')||'[]');

    let html = `<h3>Estoque Matéria-Prima</h3><ul>`;
    mp.forEach(m=> html+=`<li>${m.nome}: ${m.estoque?.toFixed(1)||0} kg</li>`);
    html += `</ul><h3>Peças Produzidas</h3><ul>`;
    pecas.forEach(p=> html+=`<li>${p.codigo} - ${p.nome}: ${p.produzidas||0} unid.</li>`);
    html += `</ul><h3>Últimas 20 Produções</h3><ol>`;
    prod.slice(-20).reverse().forEach(p=> {
      html += `<li>${p.data} → ${p.peca} × ${p.qtd} (Borra: ${p.borra} kg)</li>`;
    });
    html += `</ol>`;
    document.getElementById('conteudo').innerHTML = html;

    function gerarPDF(){
      html2pdf().from(document.getElementById('relatorio')).save('Relatorio_Injetoras.pdf');
    }
    function enviarWhats(){
      const texto = encodeURIComponent(document.getElementById('conteudo').innerText);
      window.open(`https://wa.me/?text=*RELATÓRIO INJETORAS PRO*%0A%0A${texto}`);
    }
  </script>
</body>
</html>
