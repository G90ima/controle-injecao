<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matéria-Prima</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-white">
  <!-- MENU FIXO (igual em todas as páginas) -->
  <nav class="navbar fixed-top bg-black">
    <div class="container-fluid">
      <a class="navbar-brand text-warning fs-4" href="dashboard.html">Injetoras PRO</a>
      <a class="btn btn-outline-light" href="index.html">Sair</a>
    </div>
  </nav>

  <div class="container mt-5 pt-5">
    <h2 class="text-center mb-4">Matéria-Prima</h2>
    <div class="card bg-secondary p-4 mb-4">
      <div class="row g-3">
        <div class="col-md-4">
          <input type="text" id="nome" class="form-control" placeholder="Nome do Material">
        </div>
        <div class="col-md-3">
          <select id="tipo" class="form-select"><option>Virgem</option><option>Reciclado</option></select>
        </div>
        <div class="col-md-3">
          <input type="file" id="foto" accept="image/*" class="form-control">
        </div>
        <div class="col-md-2">
          <button class="btn btn-success w-100" onclick="addMP()">Adicionar</button>
        </div>
      </div>
    </div>

    <div id="listaMP" class="row"></div>
  </div>

  <script>
    if(!sessionStorage.getItem('logado')) location.href='index.html';
    function addMP(){
      const nome = document.getElementById('nome').value;
      const tipo = document.getElementById('tipo').value;
      const file = document.getElementById('foto').files[0];
      if(!nome) return alert('Preencha o nome!');
      
      const reader = new FileReader();
      reader.onload = function(e){
        const mp = JSON.parse(localStorage.getItem('materias')||'[]');
        mp.push({nome,tipo,estoque:0,foto:e.target.result});
        localStorage.setItem('materias',JSON.stringify(mp));
        listar();
      }
      if(file) reader.readAsDataURL(file);
      else reader.onload({target:{result:''}});
    }
    function listar(){
      const lista = document.getElementById('listaMP');
      const mp = JSON.parse(localStorage.getItem('materias')||'[]');
      lista.innerHTML = '';
      mp.forEach((m,i)=>{
        lista.innerHTML += `
          <div class="col-md-4 mb-3">
            <div class="card bg-dark text-white">
              ${m.foto?`<img src="${m.foto}" class="card-img-top" style="height:200px;object-fit:cover">`:''}
              <div class="card-body">
                <h5>${m.nome} (${m.tipo})</h5>
                <p>Estoque: <strong>${m.estoque} kg</strong></p>
                <button class="btn btn-success" onclick="entrada(${i})">+ Entrada</button>
                <button class="btn btn-danger" onclick="saida(${i})">- Saída</button>
              </div>
            </div>
          </div>`;
      });
    }
    function entrada(i){
      const q = prompt('Quantos kg entraram?');
      if(q){
        const mp = JSON.parse(localStorage.getItem('materias'));
        mp[i].estoque += parseFloat(q);
        localStorage.setItem('materias',JSON.stringify(mp));
        listar();
      }
    }
    listar();
  </script>
</body>
</html>
